# フォルダー構成最適化 - 実装タスクリスト

## 実装計画

段階的で安全な移行を実現するため、以下のタスクを順次実行します。各タスクは独立して実行可能で、動作確認を行いながら進めることができます。

## タスクリスト

- [x] 1. プロジェクト準備とバックアップ
  - 現在の構造をバックアップし、移行準備を行う
  - Git作業ブランチの作成
  - 依存関係の確認
  - _要件: 7.1, 7.2_

- [x] 2. 設定ファイルとユーティリティの統合
  - [x] 2.1 config ディレクトリの作成と設定ファイル統合
    - `config/` ディレクトリを作成
    - サイト設定、ダッシュボード設定、認証設定ファイルを作成
    - 既存の設定値を新しい構造に移行
    - _要件: 4.1, 4.3_

  - [x] 2.2 lib/constants ディレクトリの作成
    - `lib/constants/` ディレクトリを作成
    - `categories.ts`, `routes.ts`, `static-data.ts` を移動・統合
    - インデックスファイルでエクスポートを統一
    - _要件: 3.3, 3.4_

  - [x] 2.3 lib/utils ディレクトリの整理
    - `lib/utils/` ディレクトリを作成
    - 既存の `utils.ts`, `audio-utils.ts`, `error-handling.ts`, `performance-monitor.ts` を分類・移動
    - 新しい構造でのインポートパスを更新
    - _要件: 3.3, 6.3_

- [x] 3. API層の統合
  - [x] 3.1 lib/api ディレクトリ構造の作成
    - `lib/api/` ディレクトリを作成
    - `database/`, `supabase/`, `services/` サブディレクトリを作成
    - _要件: 3.2, 3.4_

  - [x] 3.2 データベース関連ファイルの移動
    - `lib/database.ts` → `lib/api/database/database.ts`
    - `lib/database.types.ts` → `lib/api/database/types.ts`
    - 新しいクエリファイル `lib/api/database/queries.ts` を作成
    - _要件: 3.2, 3.4_

  - [x] 3.3 Supabaseクライアントファイルの整理
    - `lib/supabase/` → `lib/api/supabase/`
    - インデックスファイルでエクスポートを統一

    - _要件: 3.2, 3.4_

  - [x] 3.4 サービス層ファイルの移動
    - `lib/data-provider.ts` → `lib/api/services/data-provider.ts`
    - `lib/server-word-fetcher.ts` → `lib/api/services/word-fetcher.ts`
    - 新しい認証サービスファイルを作成
    - _要件: 3.2, 3.4_

- [x] 4. 型定義の統合
  - [x] 4.1 lib/types ディレクトリの作成
    - `lib/types/` ディレクトリを作成
    - 既存の `lib/types.ts` を分割
    - `api.ts`, `components.ts`, `stores.ts`, `database.ts` に分類
    - _要件: 3.4, 6.3_

  - [x] 4.2 型定義ファイルの統合とエクスポート
    - 各型定義ファイルのインデックスファイルを作成
    - 全体のエクスポートを統一
    - 既存のインポートパスを更新
    - _要件: 3.4, 6.3_

- [x] 5. カスタムフックの整理
  - [x] 5.1 lib/hooks ディレクトリの拡張
    - 既存の `lib/hooks/` を拡張
    - 新しいフック `use-learning.ts`, `use-audio.ts`, `use-local-storage.ts` を作成
    - _要件: 3.3, 6.2_

  - [x] 5.2 フック統合とエクスポート
    - 全フックのインデックスファイルを作成
    - 既存コンポーネントでの使用箇所を更新
    - _要件: 3.3, 6.3_

- [-] 6. コンポーネント構造の最適化
  - [x] 6.1 components/ui ディレクトリの整理
    - 既存の `components/ui/` を機能別にサブディレクトリに分類
    - `button/`, `card/`, `modal/`, `form/`, `feedback/`, `navigation/` を作成
    - 各コンポーネントを適切なディレクトリに移動
    - _要件: 2.1, 2.3_

  - [x] 6.2 components/features ディレクトリの作成
    - `components/features/` ディレクトリを作成
    - `auth/`, `learning/`, `dashboard/`, `search/`, `contact/` サブディレクトリを作成
    - _要件: 2.2, 6.2_

  - [x] 6.3 認証コンポーネントの移動
    - `components/auth/` → `components/features/auth/`
    - インデックスファイルでエクスポートを統一
    - _要件: 2.2, 6.2_

  - [x] 6.4 学習機能コンポーネントの統合
    - `components/features/learning/` 内に機能別サブディレクトリを作成
    - `flashcard/`, `quiz/`, `review/`, `browse/`, `shared/` を作成
    - 既存の学習関連コンポーネントを適切に分類・移動
    - _要件: 2.2, 6.2_

  - [x] 6.5 components/layout ディレクトリの作成
    - `components/layout/` ディレクトリを作成
    - `header/`, `sidebar/`, `footer/` サブディレクトリを作成
    - `components/common/` からレイアウト関連コンポーネントを移動
    - _要件: 2.3, 6.2_

  - [x] 6.6 components/shared ディレクトリの作成
    - `components/shared/` ディレクトリを作成
    - `components/common/` から共通コンポーネントを移動
    - プロバイダーコンポーネントは `components/providers/` に分離
    - _要件: 2.1, 6.2_

- [x] 7. App Routerの最適化
  - [x] 7.1 ルートグループディレクトリの作成
    - `app/(auth)/`, `app/(dashboard)/`, `app/(marketing)/`, `app/(admin)/` を作成
    - 各ルートグループのレイアウトファイルを作成
    - _要件: 1.1, 1.2_

  - [x] 7.2 認証関連ページの移動
    - `app/auth/` → `app/(auth)/auth/`
    - `app/demo-login/` → `app/(auth)/demo-login/`
    - 認証レイアウトファイルを作成
    - _要件: 1.1, 1.2_

  - [x] 7.3 ダッシュボード関連ページの移動
    - `app/dashboard/` → `app/(dashboard)/dashboard/`
    - `app/dashboard/profile/` → `app/(dashboard)/profile/`
    - `app/dashboard/statistics/` → `app/(dashboard)/statistics/`
    - `app/dashboard/search/` → `app/(dashboard)/search/`
    - `app/dashboard/review/` → `app/(dashboard)/review/`
    - ダッシュボードレイアウトファイルを作成
    - _要件: 1.1, 1.2_

  - [x] 7.4 学習機能ページの統合
    - `app/(dashboard)/learning/` ディレクトリを作成
    - `app/dashboard/category/[category]/` → `app/(dashboard)/learning/[category]/`
    - `app/dashboard/start-learning/` の機能を統合
    - 学習機能の共通レイアウトを作成
    - _要件: 1.1, 1.3_

  - [x] 7.5 マーケティングページの移動
    - `app/landing/` → `app/(marketing)/landing/`
    - `app/faq/` → `app/(marketing)/faq/`
    - `app/contact/` → `app/(marketing)/contact/`
    - マーケティングレイアウトファイルを作成
    - _要件: 1.1, 1.2_

  - [x] 7.6 管理者ページの移動
    - `app/admin/` → `app/(admin)/admin/`
    - 管理者レイアウトファイルを作成
    - _要件: 1.1, 1.2_

- [x] 8. インポートパスの一括更新
  - [x] 8.1 TypeScriptパス設定の更新
    - `tsconfig.json` のパスマッピングを新しい構造に更新
    - エイリアス設定を最適化
    - _要件: 6.3, 7.2_

  - [x] 8.2 コンポーネントインポートの更新
    - 全ファイルのインポートパスを新しい構造に更新
    - 自動化スクリプトを使用して一括更新
    - _要件: 6.3, 7.2_

  - [x] 8.3 API関連インポートの更新
    - API、ユーティリティ、フック関連のインポートパスを更新
    - 型定義のインポートパスを更新
    - _要件: 6.3, 7.2_

- [x] 9. ドキュメントとスクリプトの整理
  - [x] 9.1 docs ディレクトリの再編成
    - `docs/` 内を重要度別・カテゴリ別に整理

    - `architecture/`, `development/`, `deployment/`, `database/`, `security/`, `legacy/` を作成
    - 既存ドキュメントを適切なカテゴリに移動
    - _要件: 4.2, 8.4_

  - [x] 9.2 scripts ディレクトリの分類
    - `scripts/` 内を用途別に整理
    - `development/`, `database/`, `audio/` サブディレクトリを作成
    - 既存スクリプトを適切なカテゴリに移動
    - _要件: 4.3, 8.4_

- [ ] 10. テスト構造の最適化
  - [ ] 10.1 テストディレクトリの作成
    - `__tests__/` ディレクトリを作成
    - `components/`, `lib/`, `pages/` サブディレクトリを作成
    - _要件: 8.4_

  - [ ] 10.2 既存テストファイルの移動
    - 既存のテストファイルを新しい構造に移動
    - テスト設定ファイルを更新
    - _要件: 7.4, 8.4_

- [x] 11. 設定ファイルの更新
  - [x] 11.1 Next.js設定の最適化
    - `next.config.ts` のパッケージ最適化設定を更新
    - 新しいディレクトリ構造に対応したバンドル分割設定
    - _要件: 5.1, 5.3_

  - [x] 11.2 ESLintとPrettier設定の更新
    - 新しいディレクトリ構造に対応した設定
    - インポート順序の最適化
    - _要件: 6.3_

  - [x] 11.3 Jest設定の更新
    - テストファイルパスの更新
    - モジュールマッピングの最適化
    - _要件: 7.4_

- [x] 12. 動作確認とテスト
  - [x] 12.1 ビルドテストの実行
    - `npm run build` でエラーがないことを確認
    - TypeScriptコンパイルエラーの修正
    - _要件: 7.1, 7.4_

  - [x] 12.2 開発サーバーでの動作確認
    - `npm run dev` で全ページが正常に表示されることを確認
    - 各機能が正常に動作することを確認
    - _要件: 7.1, 7.4_

  - [x] 12.3 テストスイートの実行
    - 単体テストが全て通ることを確認
    - E2Eテストが正常に実行されることを確認
    - _要件: 7.4_

- [x] 13. パフォーマンス最適化の確認

  - [x] 13.1 バンドルサイズの確認
    - `npm run build:analyze` でバンドルサイズを確認
    - 不要な依存関係の除去
    - _要件: 5.1, 5.4_

  - [x] 13.2 読み込み速度の測定
    - Lighthouse スコアの測定
    - Core Web Vitals の確認
    - _要件: 5.1, 5.2_

- [-] 14. 不要ファイルのクリーンアップ


  - [x] 14.1 古いファイルの削除


    - 移動済みファイルの削除
    - 重複ファイルの除去
    - _要件: 4.4, 8.4_

  - [ ] 14.2 未使用依存関係の削除








    - `npm audit` で不要なパッケージを特定
    - 未使用の依存関係を削除
    - _要件: 4.4, 8.4_

- [ ] 15. 将来の拡張性対応
  - [ ] 15.1 国際化対応の準備
    - `lib/i18n/` ディレクトリを作成
    - 多言語ファイル配置の準備
    - 国際化フックの作成
    - _要件: 8.4_

  - [ ] 15.2 マイクロサービス化の準備
    - ドメイン境界の明確化
    - API境界の文書化
    - サービス分離の指針作成
    - _要件: 8.3_

- [ ] 16. SEO最適化の実装
  - [ ] 16.1 メタデータ戦略の実装
    - 動的メタデータ生成の実装
    - OGP画像の最適化
    - 構造化データの追加
    - _要件: 5.4_

  - [ ] 16.2 サイトマップとrobots.txtの最適化
    - 動的サイトマップ生成の実装
    - robots.txt の最適化
    - _要件: 5.4_

- [ ] 17. セキュリティ強化
  - [ ] 17.1 環境変数管理の強化
    - 環境変数の分類と管理
    - セキュリティ設定の統合
    - _要件: 7.3_

  - [ ] 17.2 認証・認可の階層化確認
    - ルートレベル認証の確認
    - ページレベル認証の確認
    - API認証の確認
    - _要件: 7.3_

- [ ] 18. 開発体験の最終確認
  - [ ] 18.1 開発者向けドキュメントの作成
    - 新しい構造での開発ガイド作成
    - コンポーネント作成ガイドライン
    - ベストプラクティス集の作成
    - _要件: 6.1, 6.4_

  - [ ] 18.2 IDE設定の最適化
    - VSCode設定の更新
    - TypeScript設定の最適化
    - デバッグ設定の更新
    - _要件: 6.3_

- [ ] 19. ドキュメントの更新
  - [ ] 19.1 README.md の更新
    - 新しいフォルダー構造の説明を追加
    - 開発ガイドラインの更新
    - クイックスタートガイドの更新
    - _要件: 6.1, 8.4_

  - [ ] 19.2 アーキテクチャドキュメントの更新
    - 新しい構造に基づいたアーキテクチャ図の更新
    - コンポーネント仕様書の更新
    - API仕様書の更新
    - _要件: 8.4_

- [ ] 20. 最終検証とリリース準備
  - [ ] 20.1 全機能の統合テスト
    - 全ページの動作確認
    - 全API エンドポイントの動作確認
    - 認証フローの確認
    - _要件: 7.1, 7.4_

  - [ ] 20.2 パフォーマンス最終確認
    - Lighthouse スコアの最終確認
    - バンドルサイズの最終確認
    - 読み込み速度の最終測定
    - _要件: 5.1, 5.2_

  - [ ] 20.3 本番環境での動作確認
    - ステージング環境でのテスト
    - 本番環境での動作確認
    - ロールバック手順の確認
    - _要件: 7.1, 7.3_

各タスクは独立して実行可能で、段階的な移行により既存機能への影響を最小化します。各段階で動作確認を行い、問題があれば即座に修正できる構造となっています。全ての要件がカバーされ、将来の拡張性とセキュリティも考慮した包括的な移行計画です。
