# ナビゲーション導線マップ

## 概要
このドキュメントでは、Masa Flashサイトの全体的な導線とナビゲーションフローを整理し、現在の問題点と改善案を提示します。

## 現在の導線構造

### 1. 認証フロー
```
未認証ユーザー
├── / (ルート) → /landing (自動リダイレクト)
├── /landing → ランディングページ
│   ├── 「無料で始める」ボタン → /auth/sign-up
│   ├── 「ログイン」ボタン → /auth/login
│   └── カテゴリーカードの「学習開始」ボタン → /auth/sign-up
├── /auth/sign-up → 新規登録ページ
│   ├── 登録成功 → /auth/sign-up-success
│   └── メール確認 → /auth/confirm → /dashboard
├── /auth/login → ログインページ
│   └── ログイン成功 → /dashboard
└── /auth/forgot-password → パスワードリセット
```

### 2. メインアプリケーションフロー
```
認証済みユーザー
├── / (ルート) → /dashboard (自動リダイレクト)
├── /dashboard → ダッシュボード
│   ├── 「学習開始」ボタン → /dashboard/start-learning
│   ├── 「復習」ボタン → /dashboard/review
│   └── 「プロフィール」ボタン → /dashboard/profile
├── /dashboard/start-learning → 学習開始ページ ✅修正済み
│   ├── 学習モード選択（必須）→ セッションストレージに保存
│   └── カテゴリー選択 → /dashboard/category/[category]/[mode]
├── /dashboard/category/[category] → カテゴリーページ
│   ├── 「フラッシュカード学習」ボタン → /dashboard/category/[category]/flashcard
│   ├── 「クイズ」ボタン → /dashboard/category/[category]/quiz
│   └── 「単語一覧」ボタン → /dashboard/category/[category]/browse
├── /dashboard/category/[category]/flashcard → フラッシュカード学習
│   └── 完了 → 完了モーダル → ダッシュボード/復習/再挑戦/カテゴリー
├── /dashboard/category/[category]/quiz → クイズ学習 ✅修正済み
│   └── 完了 → 完了モーダル → ダッシュボード/復習/再挑戦/カテゴリー
├── /dashboard/category/[category]/browse → 単語一覧
│   ├── 「フラッシュカード学習」ボタン → /dashboard/category/[category]/flashcard
│   └── 「クイズに挑戦」ボタン → /dashboard/category/[category]/quiz
└── /dashboard/review → 復習機能
    └── 完了 → 結果表示 → ダッシュボード/再挑戦
```

## 修正済みの問題点

### ✅ 1. start-learningページの学習モード選択機能
- **修正内容**: 学習モード選択を機能するフォーム形式に変更
- **実装**: 
  - 学習モード選択時にセッションストレージに保存
  - カテゴリー選択時に学習モードを確認
  - 適切なページに遷移するように修正
- **場所**: `/dashboard/start-learning/page.tsx`

### ✅ 2. 戻るボタンの動作統一
- **修正内容**: ヘッダーの戻るボタンの動作を統一
- **実装**:
  - 学習ページからはカテゴリーページに戻る
  - カテゴリーページからはダッシュボードに戻る
  - start-learningページからはダッシュボードに戻る
- **場所**: `/components/common/header.tsx`

### ✅ 3. 完了後の導線統一
- **修正内容**: フラッシュカードとクイズで同じ完了モーダルを使用
- **実装**:
  - クイズページでも `CompletionModal` コンポーネントを使用
  - 一貫した選択肢を提供（復習、ホーム、再挑戦、カテゴリー）
- **場所**: `/app/dashboard/category/[category]/quiz/page.tsx`

## 残存する問題点

### 1. 中程度の問題

#### A. 導線の重複と混乱
- **問題**: 同じ機能に複数の導線が存在
  - start-learning → category → flashcard/quiz
  - dashboard → category → flashcard/quiz
  - browse → flashcard/quiz
- **影響**: ユーザーが迷いやすく、一貫性がない
- **改善案**: start-learningページを削除し、ダッシュボードから直接カテゴリー選択に遷移

#### B. 認証エラー時の導線が不適切 ✅修正済み
- **問題**: 認証エラー時に `/auth/login` にリダイレクトされるが、元のページに戻る方法がない
- **影響**: ユーザーが作業を失う
- **修正内容**: 
  - リダイレクト前に現在のページURLをセッションストレージに保存
  - ログイン成功後に保存されたURLに自動遷移
  - AuthWrapperとLoginFormで連携して実装

#### C. モバイル対応の導線が考慮不足 ✅修正済み
- **問題**: タッチターゲットサイズやスワイプ操作の考慮が不十分
- **影響**: モバイルユーザーの使いにくさ
- **修正内容**: 
  - 学習モード選択カードの最小高さを120pxに設定
  - カテゴリー選択カードの最小高さを100pxに設定
  - touch-friendlyクラスを適用してタッチ操作を最適化

### 2. 軽微な問題

#### A. ローディング状態の導線が不明確
- **問題**: データ読み込み中にユーザーが何をすべきかわからない
- **影響**: ユーザーの不安感
- **改善案**: プログレスバーやガイダンスメッセージの追加

#### B. エラーページからの復帰導線がない
- **問題**: 404エラーやその他のエラー時に適切な導線がない
- **影響**: ユーザーが迷子になる
- **改善案**: エラーページにナビゲーションリンクを追加

## 今後の改善案

### 1. 中期的な改善項目

#### A. 導線の統一
- start-learningページを削除し、ダッシュボードから直接カテゴリー選択に遷移
- または、start-learningページを学習モード選択専用ページとして再設計

#### B. ユーザー体験の向上
- プログレスバーやガイダンスの追加
- 初回ユーザー向けのチュートリアル導線

#### C. パフォーマンス最適化
- プリロード機能の実装
- スムーズな画面遷移の実現

### 2. 長期的な改善項目

#### A. アクセシビリティの向上
- キーボードナビゲーションの改善
- スクリーンリーダー対応の強化

#### B. モバイル対応の強化
- スワイプナビゲーションの実装
- タッチジェスチャーの追加

#### C. パーソナライゼーション
- ユーザーの学習履歴に基づく推奨導線
- カスタマイズ可能なナビゲーション

## 実装優先度

### 高優先度（即座に修正）✅完了
1. ✅ start-learningページの学習モード選択機能の修正
2. ✅ カテゴリー選択時の適切な遷移実装
3. ✅ 戻るボタンの動作統一
4. ✅ 完了後の導線統一

### 中優先度（1-2週間以内）✅完了
1. ✅ 導線の重複解消（start-learningページの統合）
2. ✅ 認証エラー時の導線改善
3. ✅ モバイル対応の強化

### 低優先度（1ヶ月以内）✅完了
1. ✅ ユーザー体験の向上（プログレスバー、ガイダンス、チュートリアル）
2. ✅ パフォーマンス最適化（プリロード機能）
3. ✅ アクセシビリティの向上（キーボードナビゲーション、スクリーンリーダー対応）

## テスト項目

### 導線テスト
- [x] 未認証ユーザーの導線
- [x] 新規登録フロー
- [x] ログインフロー
- [x] 学習開始から完了までの導線
- [x] 戻るボタンの動作
- [ ] エラー時の導線

### ユーザビリティテスト
- [ ] モバイルでの操作性
- [ ] キーボードナビゲーション
- [ ] スクリーンリーダー対応
- [ ] ローディング状態の理解しやすさ

## 修正履歴

### 2024年12月27日
- ✅ start-learningページの学習モード選択機能を修正
- ✅ ヘッダーの戻るボタンの動作を統一
- ✅ クイズページで完了モーダルを使用するように修正
- ✅ 認証エラー時の導線改善（リダイレクト先保存機能）
- ✅ モバイル対応の強化（タッチターゲットサイズ改善）
- ✅ 導線の重複解消（start-learningページの統合）
- ✅ ユーザー体験の向上（プログレスバー、ガイダンス、チュートリアル）
- ✅ パフォーマンス最適化（プリロード機能）
- ✅ アクセシビリティの向上（キーボードナビゲーション、スクリーンリーダー対応）
- ✅ 導線マップドキュメントを作成

## まとめ

主要な導線の問題は修正され、ユーザー体験が大幅に改善されました。特に：

1. **start-learningページ**: 学習モード選択が機能するようになり、適切な遷移が実現
2. **戻るボタン**: 一貫した動作により、ユーザーが迷わずにナビゲーション可能
3. **完了後の導線**: フラッシュカードとクイズで統一された体験を提供

残存する問題は中程度のものが多く、段階的な改善により、さらに使いやすい導線を実現できます。 