# パスワードリセット機能 テストチェックリスト

## テスト実施日: _____________

## 前提条件

- [ ] ローカル開発環境が起動している (`npm run dev`)
- [ ] Supabaseプロジェクトに接続されている
- [ ] テスト用のユーザーアカウントが登録されている
- [ ] Supabaseダッシュボードで以下のURLが登録されている：
  - `http://localhost:3000/auth/confirm`
  - `http://localhost:3000/auth/update-password`

## テストケース

### 1. パスワードリセット要求（正常系）

#### 手順
1. ブラウザで `http://localhost:3000/auth/forgot-password` にアクセス
2. 登録済みのメールアドレスを入力
3. 「リセットメールを送信」ボタンをクリック

#### 期待結果
- [ ] 成功メッセージが表示される：「メールを確認してください」
- [ ] エラーメッセージが表示されない
- [ ] フォームがローディング状態になる

#### 実際の結果
- 結果: ___________________________
- スクリーンショット: [ ]

---

### 2. パスワードリセットメールの確認

#### 手順
1. Supabase Dashboard → Authentication → Logs にアクセス
2. または実際のメールボックスを確認（SMTPが設定されている場合）

#### 期待結果
- [ ] パスワードリセットメールが送信されている
- [ ] メールに以下の形式のリンクが含まれている：
  ```
  http://localhost:3000/auth/confirm?token_hash=xxx&type=recovery&next=/auth/update-password
  ```

#### 実際の結果
- 結果: ___________________________
- リンクURL: ___________________________

---

### 3. パスワードリセットリンクのクリック

#### 手順
1. メール内のパスワードリセットリンクをクリック
   - または、URLを直接ブラウザにコピー＆ペースト

#### 期待結果
- [ ] `/auth/confirm` にアクセスされる
- [ ] トークンが検証される
- [ ] **自動的に `/auth/update-password` ページにリダイレクトされる**
- [ ] ダッシュボードにリダイレクトされない ← **重要！**

#### 実際の結果
- 最終的に表示されたURL: ___________________________
- 結果: ___________________________

---

### 4. パスワード更新フォームの表示

#### 手順
1. `/auth/update-password` ページが表示されることを確認

#### 期待結果
- [ ] ページタイトル「パスワードをリセット」が表示される
- [ ] 「新しいパスワード」入力フィールドが表示される
- [ ] 「パスワードの確認」入力フィールドが表示される
- [ ] 「新しいパスワードを保存」ボタンが表示される
- [ ] 「6文字以上で入力してください」というヘルプテキストが表示される

#### 実際の結果
- 結果: ___________________________
- スクリーンショット: [ ]

---

### 5. パスワード更新（正常系）

#### 手順
1. 「新しいパスワード」フィールドに `newpass123` を入力
2. 「パスワードの確認」フィールドに `newpass123` を入力
3. 「新しいパスワードを保存」ボタンをクリック

#### 期待結果
- [ ] フォームがローディング状態になる
- [ ] エラーメッセージが表示されない
- [ ] **自動的に `/dashboard` にリダイレクトされる**
- [ ] ダッシュボードが正常に表示される

#### 実際の結果
- 最終的に表示されたURL: ___________________________
- 結果: ___________________________

---

### 6. 新しいパスワードでログイン

#### 手順
1. ログアウトする
2. `/login` ページにアクセス
3. メールアドレスと新しいパスワード（`newpass123`）を入力
4. ログインボタンをクリック

#### 期待結果
- [ ] ログインが成功する
- [ ] ダッシュボードにリダイレクトされる
- [ ] エラーメッセージが表示されない

#### 実際の結果
- 結果: ___________________________

---

## エラーケースのテスト

### 7. パスワード不一致エラー

#### 手順
1. パスワードリセットメールのリンクをクリック
2. 「新しいパスワード」フィールドに `password1` を入力
3. 「パスワードの確認」フィールドに `password2` を入力
4. 「新しいパスワードを保存」ボタンをクリック

#### 期待結果
- [ ] エラーメッセージ「パスワードが一致しません」が赤い背景で表示される
- [ ] フォームが送信されない
- [ ] ページにとどまる

#### 実際の結果
- 結果: ___________________________

---

### 8. パスワード長エラー

#### 手順
1. パスワードリセットメールのリンクをクリック
2. 「新しいパスワード」フィールドに `12345`（5文字）を入力
3. 「パスワードの確認」フィールドに `12345` を入力
4. 「新しいパスワードを保存」ボタンをクリック

#### 期待結果
- [ ] エラーメッセージ「パスワードは6文字以上である必要があります」が表示される
- [ ] または、ブラウザのHTML5バリデーションが発動する
- [ ] フォームが送信されない

#### 実際の結果
- 結果: ___________________________

---

### 9. 無効なトークンでのアクセス

#### 手順
1. 以下のような無効なトークンでURLにアクセス：
   ```
   http://localhost:3000/auth/confirm?token_hash=invalid_token&type=recovery
   ```

#### 期待結果
- [ ] `/auth/error` ページにリダイレクトされる
- [ ] 「エラーが発生しました」というメッセージが表示される

#### 実際の結果
- 最終的に表示されたURL: ___________________________
- 結果: ___________________________

---

### 10. 期限切れトークンでのアクセス

#### 手順
1. パスワードリセットメールを取得
2. 1時間以上待つ（または手動でSupabase Dashboardからトークンを無効化）
3. メール内のリンクをクリック

#### 期待結果
- [ ] `/auth/error` ページにリダイレクトされる
- [ ] または、エラーメッセージが表示される

#### 実際の結果
- 結果: ___________________________

---

### 11. 未登録メールアドレスでのパスワードリセット要求

#### 手順
1. `/auth/forgot-password` ページにアクセス
2. 未登録のメールアドレス（例: `nonexistent@example.com`）を入力
3. 「リセットメールを送信」ボタンをクリック

#### 期待結果
- [ ] 成功メッセージが表示される（セキュリティのため、メールが存在しないことを明示しない）
- [ ] 「メールを確認してください」が表示される
- [ ] 実際にはメールが送信されない

#### 実際の結果
- 結果: ___________________________

---

## Middlewareの動作確認

### 12. 認証済みユーザーの `/auth/update-password` アクセス

#### 手順
1. 通常の方法でログイン
2. ブラウザのアドレスバーに `http://localhost:3000/auth/update-password` を直接入力してアクセス

#### 期待結果
- [ ] **ダッシュボードにリダイレクトされる**（パスワードリセットフロー外では、このページにアクセスできないようにする）

#### 実際の結果
- 最終的に表示されたURL: ___________________________
- 結果: ___________________________

---

### 13. 未認証ユーザーの `/auth/forgot-password` アクセス

#### 手順
1. ログアウト状態を確認
2. `/auth/forgot-password` にアクセス

#### 期待結果
- [ ] パスワードリセット要求フォームが表示される
- [ ] ログインページにリダイレクトされない

#### 実際の結果
- 結果: ___________________________

---

## ブラウザコンソールの確認

### 14. コンソールエラーチェック

#### 手順
1. 上記のすべてのテストケースを実行中、ブラウザの開発者ツールのコンソールを開いておく

#### 期待結果
- [ ] JavaScriptエラーが表示されない
- [ ] 404エラーが表示されない
- [ ] CORS エラーが表示されない

#### 実際の結果
- エラー内容: ___________________________

---

## まとめ

### テスト結果

- 成功したテストケース数: _____ / 14
- 失敗したテストケース数: _____
- ブロッカー（重大な問題）: _____

### 問題点

1. ___________________________
2. ___________________________
3. ___________________________

### 改善提案

1. ___________________________
2. ___________________________
3. ___________________________

### 総合評価

- [ ] すべてのテストケースが成功
- [ ] 一部のテストケースが失敗（詳細は上記参照）
- [ ] パスワードリセット機能は本番環境にデプロイ可能
- [ ] 追加の修正が必要

---

## 備考

___________________________
___________________________
___________________________

