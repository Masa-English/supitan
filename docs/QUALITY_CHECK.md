# 品質チェックフロー

## 概要

Masa Flashプロジェクトでは、コードの品質、セキュリティ、パフォーマンスを保証するための包括的な品質チェックフローを実装しています。

## チェック項目

### 1. 依存関係チェック
- **npm audit**: セキュリティ脆弱性の確認
- **npm outdated**: 更新可能な依存関係の確認
- **依存関係の整合性**: package-lock.jsonの確認

### 2. コード品質チェック
- **ESLint**: コードスタイルとベストプラクティスの確認
- **TypeScript**: 型安全性の確認
- **Prettier**: コードフォーマットの確認

### 3. ビルドテスト
- **Next.js ビルド**: 本番ビルドの成功確認
- **型チェック**: TypeScriptコンパイルエラーの確認
- **バンドルサイズ**: 最適化の確認

### 4. マニフェスト・設定ファイルチェック
- **package.json**: 必須フィールドとスクリプトの確認
- **設定ファイル**: Next.js、Tailwind、TypeScript、ESLint設定の確認
- **Supabase設定**: データベース設定の確認

### 5. 環境変数チェック
- **環境変数ファイル**: .env.local、.env.exampleの存在確認
- **セキュリティ**: 機密情報の露出チェック

### 6. データベースチェック
- **マイグレーション状態**: データベーススキーマの整合性確認
- **接続テスト**: Supabase接続の確認

### 7. セキュリティチェック
- **機密情報**: APIキーやパスワードの露出チェック
- **依存関係**: セキュリティ脆弱性の確認

### 8. ファイル構造チェック
- **必須ディレクトリ**: app、components、lib、public、supabaseの存在確認
- **ファイル配置**: 適切なディレクトリ構造の確認

## 実行方法

### 手動実行

```bash
# 包括的な品質チェック
npm run quality-check

# デプロイ前チェック
npm run pre-deploy

# 個別チェック
npm run lint          # ESLint
npm run type-check    # TypeScript型チェック
npm run build         # ビルドテスト
npm audit             # セキュリティ監査
```

### 自動実行

GitHub Actionsで以下のタイミングで自動実行されます：

- **プッシュ時**: main、developブランチへのプッシュ
- **プルリクエスト時**: main、developブランチへのPR
- **デプロイ前**: 本番デプロイ前の自動チェック

## チェック結果

### 成功条件

すべてのチェックが成功した場合：
- ✅ リンター: エラーなし
- ✅ 型チェック: 型エラーなし
- ✅ ビルド: 正常にビルド完了
- ✅ マニフェスト: 設定ファイル正常
- ✅ 依存関係: セキュリティ問題なし
- ✅ セキュリティ: 機密情報露出なし
- ✅ データベース: 接続・スキーマ正常

### 失敗時の対応

チェックが失敗した場合：

1. **エラーメッセージの確認**
   - 具体的なエラー内容を確認
   - ファイル名と行番号を特定

2. **修正の実施**
   - リンターエラー: コードスタイルの修正
   - 型エラー: TypeScript型の修正
   - ビルドエラー: 依存関係や設定の修正

3. **再実行**
   - 修正後に再度チェックを実行
   - 段階的に修正を確認

## 品質基準

### コード品質
- **ESLint**: エラー0、警告は最小限
- **TypeScript**: 型エラー0
- **カバレッジ**: テストカバレッジ80%以上

### パフォーマンス
- **ビルド時間**: 5分以内
- **バンドルサイズ**: 適切な最適化
- **Lighthouse**: パフォーマンススコア90以上

### セキュリティ
- **npm audit**: 中程度以上の脆弱性0
- **機密情報**: リポジトリ内に露出なし
- **依存関係**: 最新の安定版を使用

## トラブルシューティング

### よくある問題

#### 1. ESLintエラー
```bash
# 自動修正可能なエラーを修正
npm run lint -- --fix
```

#### 2. TypeScript型エラー
```bash
# 型定義の更新
npm run sync-types
```

#### 3. ビルドエラー
```bash
# キャッシュクリア
rm -rf .next node_modules/.cache
npm run build
```

#### 4. 依存関係の問題
```bash
# 依存関係の再インストール
rm -rf node_modules package-lock.json
npm install
```

### 環境固有の問題

#### Windows環境
- パス区切り文字の問題
- ファイル権限の問題

#### macOS/Linux環境
- ファイル権限の問題
- シンボリックリンクの問題

## 継続的改善

### 定期的な見直し
- 月次: 品質チェック項目の見直し
- 四半期: 新しいツールの導入検討
- 年次: 全体的な品質基準の更新

### フィードバック
- 開発チームからの改善提案
- 自動化の拡張
- チェック項目の追加・削除

## 関連ドキュメント

- [開発ワークフロー](./DEVELOPMENT_WORKFLOW.md)
- [デプロイメントガイド](./DEPLOYMENT_OPERATIONS.md)
- [セキュリティガイド](./SECURITY.md)
- [テスト戦略](./TESTING.md) 